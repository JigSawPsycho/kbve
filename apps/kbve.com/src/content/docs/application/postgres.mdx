---
title: Postgres
description: |
    The Postgres  is a powerful, open-source relational database system known for its advanced features, reliability, and strong standards compliance.
    It supports complex queries, data integrity, and extensibility through a variety of plugins, making it ideal for both small and large-scale applications.
    With support for ACID transactions, JSON, and custom extensions, Postgres is a popular choice for developers and enterprises alike.
sidebar:
    label: Postgres
    order: 1425
unsplash: 1661810056990-57be781caa2d
img: https://images.unsplash.com/photo-1661810056990-57be781caa2d?fit=crop&w=1400&h=700&q=75
tags:
    - database
---

import {
  Aside,
  Steps,
  Card,
  CardGrid,
  Code,
  FileTree,
} from '@astrojs/starlight/components';

import { Giscus, Adsense } from '@kbve/astropad';


<Aside title='Note: Postgres Versions'>

This document is for postgres v15, v16 and v17. Some of the information may not be relatable to older versions of Postgres.

</Aside>

## PostgreSQL

PostgreSQL is an advanced open-source relational database system known for its robustness, performance, and extensibility.
It adheres to SQL standards and supports a wide range of data types, making it suitable for handling structured, semi-structured, and unstructured data.
Developers and database administrators alike benefit from its rich feature set, including support for JSON, full-text search, and spatial data through extensions like `PostGIS`.
For those looking to leverage machine learning capabilities, `pgvector` offers native support for storing and querying vector embeddings, ideal for AI-based applications.
PostgreSQL also provides powerful tools like `pg_barman` for seamless backups and disaster recovery, ensuring data safety and availability.
With built-in support for logical replication and partitioning, PostgreSQL can scale horizontally and handle complex workloads efficiently.
Additionally, advanced users can create custom functions and procedures using various languages such as PL/pgSQL, Python, and even JavaScript, enhancing its capabilities further.
But wait, there is more, because of its thriving community and vast ecosystem, PostgreSQL is a versatile solution for developers and enterprises looking to build high-performance, scalable, and secure data-driven applications.

## CheatSheet

### PSQL

`psql` is a powerful command-line interface and interactive terminal for PostgreSQL, offering a convenient way to interact with databases through SQL commands.
This tool can be used to connect to databases, execute queries, and manage database objects such as tables, schemas, and extensions.
For beginners, psql provides a straightforward method to learn SQL and interact with PostgreSQL, featuring built-in help and command-line flags to assist in query execution.
Advanced users and database administrators can leverage its full scripting capabilities, including support for automated backups, customized reports, and database tuning.
Furthermore, the tool also provides powerful meta-commands (such as \dt, \du, and \l) to display database information and manipulate objects quickly.
Additionally, psql can be used to execute SQL scripts, manage PostgreSQL configurations, and run commands for extensions like `pg_stat_statements` or `pgvector`.
It is a versatile tool that is essential for PostgreSQL users of all skill levels, serving as both a learning environment and a robust management utility.

<Aside title='Note: Using psql'>

This guide provides an overview of using the `psql` command-line interface with PostgreSQL 15, 16, and 17.

It is intended for users who want to manage their PostgreSQL databases efficiently. 
Some advanced features, such as certain meta-commands and flags, may behave differently or be unavailable in older versions of `psql`.
Be sure to check the compatibility of specific commands if using an older PostgreSQL version.

</Aside>

### Extensions

---

## Supabase

Supabase is an open-source backend-as-a-service that provides a suite of tools to simplify building applications.
It offers a powerful, hosted PostgreSQL database with a built-in authentication system, storage services, and real-time functionality.
Supabase is built to scale with your application and supports various PostgreSQL extensions like pgvector for vector similarity searches and pgTAP for testing.
The platform includes a SQL Editor, allowing users to manage their data, run queries, and save frequently used SQL commands.
Supabase also integrates with tools like Barman for database backups and supports advanced features like row-level security to ensure data privacy and security.

Supabase is ideal for both beginners and experts due to its flexibility and comprehensive feature set.
It can be used for rapid prototyping, building full-stack applications, or extending existing apps with complex data relationships.
Additionally, Supabase is highly extensible, allowing developers to add Postgres extensions with just a few clicks from the dashboard, making it easy to expand database capabilities as needed!

---

## CNPG

CloudNativePG, aka CNPG, is an open-source Kubernetes operator designed to manage PostgreSQL clusters natively within Kubernetes environments.
It supports the entire lifecycle of a PostgreSQL cluster, from initial deployment to ongoing maintenance, with built-in features like automated failover, scaling of read replicas, and rolling updates.
CloudNativePG leverages native PostgreSQL streaming replication to provide high availability and disaster recovery options.
It integrates directly with the Kubernetes API server, eliminating the need for external failover management tools.
Additionally, it supports common PostgreSQL extensions and offers monitoring capabilities through Prometheus integration.
This operator is tailored to modern cloud-native architecture and is ideal for PostgreSQL deployments that require seamless management within Kubernetes.

### CNPG Image Requirements

The CloudNativePG operator for Kubernetes requires that certain PostgreSQL executables and tools be present within the container image during the image build process.
These requirements are essential for the operator to automate the management of PostgreSQL clusters, including initialization, backups, and restoration.
Without these components, the operator will not be able to perform tasks such as setting up the database, handling replication, or managing cloud-based backup solutions like Barman.
Additionally, if audit logging is required, the pgaudit extension should be installed as part of the container image build.

1. PostgreSQL Executables in Path:

- `initdb`
- `postgres`
- `pg_ctl`
- `pg_controldata`
- `pg_basebackup`

2. Barman Cloud Executables in Path (for integration with cloud storage):

- `barman-cloud-backup`
- `barman-cloud-backup-delete`
- `barman-cloud-backup-list`
- `barman-cloud-check-wal-archive`
- `barman-cloud-restore`
- `barman-cloud-wal-archive`
- `barman-cloud-wal-restore`

3. Optional PostgreSQL Extensions:

- `PGAudit` - The pgaudit extension should be pre-installed in the image if audit logging is required within the deployed PostgreSQL clusters.

4. Locale Settings:

- Ensure that appropriate locale settings are configured to support the desired language and encoding for the PostgreSQL database.


These requirements ensure compatibility and proper functionality of CloudNativePG with various PostgreSQL features, including cloud-based backup and restoration via Barman Cloud, as well as extended audit capabilities through PGAudit.

---

### CNPG Deployment Example

Here is a quick base example of the bootstrap initdb that we are using to start our cluster.

```yaml

bootstrap:
    initdb:
        database: app
        owner: app
        dataChecksums: true
        encoding: 'UTF8'
        postInitApplicationSQLRefs:
            configMapRefs:
                -   name: {{ include "supabase.db.fullname" . }}-init
                    key: configmap.sql
                -   name: {{ include "supabase.db.fullname" . }}-sql
                    key: alt.sql
        postInitApplicationSQL:
            - "ALTER DATABASE postgres SET \"app.settings.jwt_secret\" TO '{{ .Values.secret.jwt.secretRefKey.secret }}';"
            - "ALTER DATABASE postgres SET \"app.settings.jwt_exp\" TO '3600';"


```

---

## Barman

The Barman install for the postgres will be done via python or directly through the postgres ppa.
